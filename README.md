# RSSL XML Trace Viewer Tools

The utility was designed for decoding and displaying the value from RSSL XML Tracing log generated by RFA C++/.NET and EMA/ETA C/C++. The main purpose of the project is to create WPF GUI application to display data for [MRN Real-Time News](https://developers.thomsonreuters.com/sites/default/files/ThomsonReutersMRNElektronDataModelsv210_2.pdf) provided by RIC MRN_STORY. Anyway, the core functionality of the application can be used to decode value of the field entry data inside XML element. Therefore, the application can be used to open RSSL tracing log which contains data from other message model type such as Market Price, Market By Price and Market By Order. This utility should be able to help troubleshooting data issue or confirm the Market Price data or MRN Real-Time news data that API send and receive from Provider Server or TREP component. Please note that RSSL Tracing log and this utility was provided for troubleshooting purpose only.

## Prerequisites

Required software components:

* [.NET Framework](https://www.microsoft.com/net/download/dotnet-framework/net461) - .NET Framework 4.6.1 or later version
* [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/)- We use Visual Studio 2017 with C# 7.0 to develop the application.

Optional software components:

* [Visual Studio Code](https://code.visualstudio.com/) - IDE for edit source codes and open XML and JSON output from the application.

## Getting Started

The utility can be used on Windows OS only because it uses .NET Framework with WPF library which available for Windows development only. It requires Visual Studio 2017 with .NET framework 4.6.1 to build the application. It requires some additional libraries for decoding XML data and parsing the JSON data. The application requires RDMFieldDictionary and enumtype.def to decode the raw data in Hex string format to the actual value. User can update dictionary inside folder “Dict” to the latest version. In case that the application unable to find field definition for some specific fid or custom fid and enum value, it will instead display original Hex string with the fid id instead of showing fid name. Note that you can download latest version of data dictionary from the [Software Download page](https://customers.thomsonreuters.com/a/support/technical/softwaredownload/default.aspx) and then search for product name "TREP Template service pack".

Anyway, if you want the utility which can run on multiple OS such as mac OS and Linux, we have created the [RSSLTraceConverter]( https://github.com/TR-API-Samples/Example.EMARFACPP.Tool.RSSLXMLTraceConverter) which is console application which can decode and convert the data from RSSL tracing log to a new XML file. It shares the core functionality with this project. You can download it from [github](https://github.com/TR-API-Samples/Example.EMARFACPP.Tool.RSSLXMLTraceConverter).

# Overview

This utility was designed for decoding data inside RSSL XML trace log which generated by RFA C++/.NET and EMA/ETA C/C++ and it can be used to display decoded data in WPF GUI. Basically, the RSSL XML trace file was provided for troubleshooting purpose only. There is some scenario that it required data from the tracing log to confirm data integrity the application received, therefore, there is the requirement to create a tool which can convert field entry value in Hex string format to actual value so that the user can compare the value with data the application received.

Normally when the application requesting data for Market Price and Level 2 Market By Price or Market by Order, the response message usually contains a field entry with field value in Hex string format. The utility can be used to read the XML Fragment and decode the Hex string in the field entry to actual data according the data type from data dictionary. Moreover it can be used to decode the [MRN Real-Time News](https://developers.thomsonreuters.com/article/introduction-machine-readable-news-mrn-elektron-message-api-ema) which provide by using MRN_STORY Ric. The tools have application's logic to scan the XML Fragment to find a series of compressed MRN fragment data inside the tracing log and then unpack the data and shows the MRN JSON data in the GUI.

### RFA C++ and .NET application

User has to add the following configuration to turn on RSSL tracing log. <Connection_RSSL> is Connection name user are using in the configuration file.

```
\Connections\<Connection_RSSL>\connectionType    = "RSSL"
\Connections\<Connection_RSSL>\rsslPort     = "<RSSL Port>"
\Connections\<Connection_RSSL>\hostName        = "<ADS/Provider Hostname>"
\Connections\<Connection_RSSL>\traceMsg = false
\Connections\<Connection_RSSL>\traceMsgToFile = true
\Connections\<Connection_RSSL>\tracePing = true
\Connections\<Connection_RSSL>\traceMsgFileName   = "RSSLConsumerTrace"
\Connections\<Connection_RSSL>\traceMsgDomains = "all"
\Connections\<Connection_RSSL>\traceRespMsg = true
\Connections\<Connection_RSSL>\traceReqMsg = true
\Connections\<Connection_RSSL>\traceMsgHex = false 
\Connections\<Connection_RSSL>\traceMsgMaxMsgSize = 200000000
\Connections\<Connection_RSSL>\traceMsgMultipleFiles = true

```
Note that traceMsgFileName is the output xml file which RFA will generate under running directory. From above example, the output will be RSSLConsumerTrace_<pid>.xml where <pid> is the process id of the application.

### EMA C++ application

For EMA C++ application, user has to copy EmaConfig.xml which provided in EMA Examples folder to project directory or running directory and then add below XML element to EMA configuration file under section Consumer to turn on the tracing log. Note that you have to set __XmlTraceToFile__ to __1__ to turn on the log and set it to __0__ to turn off the log.

```
<DefaultConsumer value="Consumer_1"/>
<Consumer>
    <Name value="Consumer_1"/>
    ...
    <XmlTraceToFile value="1"/>
    <XmlTraceToStdout value="0"/>
</Consumer>
		
```

Though you are setting server name/ip and RSSL port in application codes and not using Channel config from the configuration file, you can also copy the configuration to the running directory and set the config under DefaultConsumer or DefaultProvider section. Above sample set DefaultConsumer to Consumer_1 then EMA internal will check the value inside the configuration file and verify option to turn on trace file from Consumer_1. And EMA will generate the RSSL Tracing log file name EmaTrace_<id>.xml under the running directory.

## Utility download

The solution project is available for from [Github](https://github.com/TR-API-Samples/Example.EMARFACPP.Tool.RSSLTraceViewer).

## Building and Running Utility

TO build the application you just clone the solution from github and then open solution file __RSSLTraceViewerGUI.sln__ with Visual Studio 2017. Then build the project with Debug or Release build.

![VisualStudio2017](/images/VS2017.PNG)

    
### Launching the application:

If you build the utility using Visual Studio 2017, you can launch the application by click RSSLTraceViewerGUI.exe which locates under Release or Debug folder like the following sample path "<GitHubRepo>\Example.EMARFACPP.Tool.RSSLTraceViewer\RSSLTraceViewerGUI\bin\Release"

![LaunchingApplication](/images/launch.PNG)

It will show a new WPF Window like the following screenshot.

![MainPage](/images/mainpagebullet.png)

There are 4 bullets from above sample. Below is the meaning of each bullet.

1. Start using the application, user has to click __Load Trace file__ button to load XML file contains RSSL Trace log.
2. Bullet 2 is text box for display path to xml file after user click __Load Trace file__ button.
3. Bullet 3 is the area of DataGrid control for display XML fragment ordered by sequence of xml inside actual XML Tracing log. The DataGrid also display time stamp, RDM Domain, Stream ID including GUID of the MRN.
4. Bullet 4 is the area of Tree View component for display decoded XML.


### Usages

To start using the application, client just click __Load Trace file__ button to load XML file as described in previous section and then the application will process the XML data and create internal data structure to keep XML Fragment list and then bind the data to DataGrid.

![Load XML Trace file](/images/mainpage5.PNG)

Below sample is screenshot when the application display XML Fragment in Data Grid.

![MainPage](/images/mainpage_loaded.png)

There is an additional information from the internal application’s log shows at the Windows caption. Following sample is details about number of XML fragments the application read from the xml.

![Additional Info](/images/AdditionalTab.png)

User can resize the windows and click at the Grid Separator at the position of Bullet 3 from the below screen shot. It allows user to drag the Separator to left or right direction.

![GridSerator](/images/MovePane.png) 

#### Unpack MRN Data 

To unpack or display uncompressed MRN Real-Time news data, the first step, user has to double click DataGrid row which contains GUID they interest in order to display data in TreeView at the right-hand side. 

Actually, the application does not decode XMLFragment data immediately after it load the XML file. Instead, it will decode the data when user double clicks one of DataGrid row. This should help reduce XML loading time at the first step.

![ClickRow](/images/MRNLoaded2.png)

Above screen shot shows the data from RSSL tracing log which contains MRN Real-Times news data from MRN_STORY RIC. After user double click DataGrid row, it will create a new TreeView control to display XML data inside TreeView from bullet 2 in the sample screen shot. Bullet 3 is button __Unpack MRN Data__ used to unpack MRN data from selected DataGrid row. Basically, the application has an internal algorithm to find relevance XML Fragments and calls the internal function to uncompressing the data and shows in a new Window like the next sample screenshot.
![Display News](/images/DisplayMRNJson.png)

Note that the __Unpack MRN Data__ button will appear when selected row containing GUID only. Moreover, if selected GUID contains invalid fragments list, the application will popup message box with details of the error. For example, when overall XML Fragments size less than or larger than total size.

#### Display and Save MRN JSON data to file

Based on the DisplayMRNData screen shot from previous section there are four bullets on the window.

1. Bullet 1 is text block for display uncompressed JSON data.
2. Bullet 2 is a list of relevant XML fragments displaying using TreeView component.
3. Bullet 3 is button for saving the raw JSON data to file. User can open the JSON file in other text editor to review data inside XML Fragments.
4. Bullet 4 is the area for display information about the GUID.

#### Display Level 1 and Level 2 Market Price data

User can just load the RSSL XML trace log which contains Market Price or Level 2 Market data. The step to display data is the same as MRN but the difference is that it does not have button __Unpack MRN data__ at the right-hand side.

![Display News](/images/MarektPriceBullet.png)

Normally, application will check whether or not the XML element contains fieldEntry element. Next step it will use internal library to get Fid name and decoding field value and then add the value to Treeview element. However, if the Fid id is custom fid and it is not available in data dictionary, the application will display value as original Hex string instead.

#### Filtering data inside DataGrid

There is an option for user to filter data by clicking the small button at the DataGrid column. There are some columns that are Msg Type, Key (item name, user name in the message), Domain and Stream Id that can be used to filter data. The application also provides interface to search MRN data by using GUID.

To use the filter, user can just click at the small button on the column header, then it will pop up a Combo box containing a list of available filter values for each column. Then user can just tick or untick a Checkbox inside the Combo box to select the value they interest. The application will apply the values with internal XML Fragments data and display data inside DataGrid based on the criteria. Below are sample screenshots when user click the button on the column header.

![DomainFiltering](/images/filterDomainBullet.png)

![MsgTypeFiltering](/images/filtermsgtye.png)

The following screenshot is sample output when user filter only refreshMsg.

![MsgTypeFiltering](/images/msgtyperesult.PNG)

#### Searching GUID

If the data inside RSSL Tracing log contains MRN data with GUID list, the application will show GUID search box above the DataGrid aread. User just input GUID text in GUID search box and the click __Search__ button. The application will perform searching the GUID with data insdie the DataGrid. Below screenshot is the sample output.

![MsgTypeFiltering](/images/GuidSearchBullet.png)

Bullet 1 is GUID string user want to search and Bullet 2 is the result. The functionality should be able to help user confirm if the data they receive contains the some specific GUID or not.

## Limitation of Utility

1) Current version of the XML parser used by the Utility was designed and tested with the RSSL tracing log from Elektron SDK C++ and the new version of RFA C++ 7.6 or later version. So it may not support the log from the old version of RFA C++ or UPA. This is because the old version use a difference XML format and structure. The XML parser requires additional XML comment come before the XML element containing the RSSL message, in order to get type of message (Incoming or Outgoing) and the time stamp the message sent or receive. It also required some attribute such as domainType and streamId XML attribute in the XML element. The supported XML structure should contains XML element and its attribute like the following sample.

Sample of requestMsg.
```XML

<!-- Outgoing Message <string> -->
<!-- Time: <Time String> -->
<!-- rwfMajorVer="<major version>" rwfMinorVer="<minor version>" -->
<requestMsg domainType="<Domain Type>" streamId="<Stream Id>"... >
    <key ... name="<key name>" ...>
        ...
    </key>
    <dataBody>
    </dataBody>
</requestMsg>
```

Sample of updateMsg or refreshMsg.
```XML
<!-- Incoming Message <Message> -->
<!-- Time: <Time> -->
<!-- rwfMajorVer="14" rwfMinorVer="0" -->
<refreshMsg domainType="<Domain Type>" streamId="<Stream Id>" ...>
    <key ... name="VOD.L" .../>
    <dataBody>
        <fieldList flags="0x9 (RSSL_FLF_HAS_FIELD_LIST_INFO|RSSL_FLF_HAS_STANDARD_DATA)" fieldListNum="194" dictionaryId="1">
            <fieldEntry fieldId="1" data="15F9"/>
            <fieldEntry fieldId="2" data="73"/>
            <fieldEntry fieldId="3" data="564F 4441 464F 4E45 2047 524F 5550"/>
           ...
            <fieldEntry fieldId="32741" data=""/>
            <fieldEntry fieldId="32743" data=""/>
        </fieldList>
    </dataBody>
</refreshMsg>


<!-- Incoming Message <Message> -->
<!-- Time: <Time> -->
<!-- rwfMajorVer="<major version>" rwfMinorVer="<minorversion>" -->
<updateMsg domainType="<Domain Type>" streamId="<Stream Id>" ...>
    ...
            <mapEntry flags="0x0" action="RSSL_MPEA_ADD_ENTRY" key="5@4154DB03" >
                <fieldList flags="0x8 (RSSL_FLF_HAS_STANDARD_DATA)">
                    <fieldEntry fieldId="3427" data="0B01 0842"/>
                    <fieldEntry fieldId="3429" data="0E03 20"/>
                    <fieldEntry fieldId="3428" data="01"/>
                    <fieldEntry fieldId="3426" data="3130 3936 3038 3031 3331"/>
                    <fieldEntry fieldId="6520" data="014C E5F9"/>
                    <fieldEntry fieldId="6522" data="040A 07E2"/>
                </fieldList>
            </mapEntry>
    ...
</updateMsg>

```

2) The XML Parser will stop parsing the XML file if it found parsing error in XML such as an invalid character or incomplete XML element. The application will popup message box with additional details about the exception from .NET XML class used by the application. A user may need to manually remove invalid XML tag or XML element from the XML file.

3) The application can just decoding data in XML element name "fieldEntry" and it must contain attributes name "fieldId" and "data". Otherwise the application unable to parse the field data inside RSSL message.

4) As described in the first limitation that the format of XML element must contain the same structure as RSSL Trace from EMA C++ or RFA C++ 7.6 and later version. However, there is an option for the user who wants to use the utility to decode a snapshot of data. There are additional configuration named  "__UseRDMStrictMode__"(default is True) in __app.config.json__ which user can set it to __False__ to allow the application parsing the XML fragments inside the XML file without checking the format or structure of the XML message. 

For example,

You want to decode fieldEntry inside specific update message such as Market By Price update and MRN update messages like the following sample XML data.

```XML
<updateMsg domainType="RSSL_DMT_MARKET_BY_ORDER" streamId="4" containerType="RSSL_DT_MAP" flags="0x10 (RSSL_UPMF_HAS_SEQ_NUM)" updateType="0 (RDM_UPD_EVENT_TYPE_UNSPECIFIED)" seqNum="15536" dataSize="79">
    <dataBody>
        <map flags="0x2 (RSSL_MPF_HAS_SUMMARY_DATA)" countHint="0" keyPrimitiveType="RSSL_DT_BUFFER" containerType="RSSL_DT_FIELD_LIST" >
            <summaryData>
                <fieldList flags="0x8 (RSSL_FLF_HAS_STANDARD_DATA)">
                    <fieldEntry fieldId="4148" data="014C E5F9"/>
                </fieldList>
            </summaryData>
            <mapEntry flags="0x0" action="RSSL_MPEA_ADD_ENTRY" key="5@4154DB03" >
                <fieldList flags="0x8 (RSSL_FLF_HAS_STANDARD_DATA)">
                    <fieldEntry fieldId="3427" data="0B01 0842"/>
                    <fieldEntry fieldId="3429" data="0E03 20"/>
                    <fieldEntry fieldId="3428" data="01"/>
                    <fieldEntry fieldId="3426" data="3130 3936 3038 3031 3331"/>
                    <fieldEntry fieldId="6520" data="014C E5F9"/>
                    <fieldEntry fieldId="6522" data="040A 07E2"/>
                </fieldList>
            </mapEntry>
        </map>
    </dataBody>
</updateMsg>

<updateMsg domainType="RSSL_DMT_NEWS_TEXT_ANALYTICS" streamId="3" containerType="RSSL_DT_FIELD_LIST" flags="0x1D2 (RSSL_UPMF_HAS_PERM_DATA|RSSL_UPMF_HAS_SEQ_NUM|RSSL_UPMF_DO_NOT_CACHE|RSSL_UPMF_DO_NOT_CONFLATE|RSSL_UPMF_DO_NOT_RIPPLE)" updateType="0 (RDM_UPD_EVENT_TYPE_UNSPECIFIED)" seqNum="3694" permData="0308 4310 154C" dataSize="2717">
    <dataBody>
        <fieldList flags="0x8 (RSSL_FLF_HAS_STANDARD_DATA)">
            <fieldEntry fieldId="4148" data="0226 3EF3"/>
            <fieldEntry fieldId="17" data="0A0A 07E2"/>
            <fieldEntry fieldId="8593" data="5354 4F52 59"/>
            <fieldEntry fieldId="8506" data="32"/>
            <fieldEntry fieldId="11787" data="3130"/>
            <fieldEntry fieldId="32480" data="0AF9"/>
            <fieldEntry fieldId="32479" data="01"/>
            <fieldEntry fieldId="4271" data="5253 4A35 3836 3444 615F 3138 3130 3130 3269 472F 4B42 2B72 456C 6239 6F41 464A
                4138 5A53 5373 4831 4C42 6232 2B2F 6F54 6C37 5736 7644"/>
           ...
        </fieldList>
    </dataBody>
</updateMsg>


<updateMsg domainType="RSSL_DMT_NEWS_TEXT_ANALYTICS" streamId="3" containerType="RSSL_DT_FIELD_LIST" flags="0x1D2 (RSSL_UPMF_HAS_PERM_DATA|RSSL_UPMF_HAS_SEQ_NUM|RSSL_UPMF_DO_NOT_CACHE|RSSL_UPMF_DO_NOT_CONFLATE|RSSL_UPMF_DO_NOT_RIPPLE)" updateType="0 (RDM_UPD_EVENT_TYPE_UNSPECIFIED)" seqNum="3710" permData="0308 4310 154C" dataSize="288">
    <dataBody>
        <fieldList flags="0x8 (RSSL_FLF_HAS_STANDARD_DATA)">
            <fieldEntry fieldId="4271" data="5253 4A35 3836 3444 615F 3138 3130 3130 3269 472F 4B42 2B72 456C 6239 6F41 464A
                4138 5A53 5373 4831 4C42 6232 2B2F 6F54 6C37 5736 7644"/>
            <fieldEntry fieldId="12215" data="4844 435F 5052 445F 41"/>
            <fieldEntry fieldId="32479" data="02"/>
            <fieldEntry fieldId="32641" data="4586 490A 8756 9191 83E2 0BD2...>
        </fieldList>
    </dataBody>
</updateMsg>

```
The user can just copy these three XML fragments to a new XML file and then set UseRDMStrictMode to False and re-launch the utility. It should be able to parse the XML data and decode the MRN message if it contains all MRN fragments in the XML file. The application will shows the data in the GUI like below screenshot.

![NoRDMStrictMode](/images/StrictMode.png)

Anyway, instead of using this utility to open this kind of XML Trace messages, there is an alternate command line utility which user can used to decode the data from the same XML file. Please refer to [RSSL XML Trace Converter](https://github.com/TR-API-Samples/Example.EMARFACPP.Tool.RSSLXMLTraceConverter). The command line utility will convert the file to a new XML file contains decoded value instead.

## Contributing

Please read [CONTRIBUTING.md](https://gist.github.com/PurpleBooth/b24679402957c63ec426) for details on our code of conduct, and the process for submitting pull requests to us.

## Authors

* **Moragodkrit Chumsri** - Release 1.0 *Initial work*

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details


