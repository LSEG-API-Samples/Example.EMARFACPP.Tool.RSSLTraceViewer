# RSSL XML Trace Viewer Tools

The utility was designed for decoding and displaying the value from RSSL XML Tracing log generated by RFA C++/.NET and EMA/ETA C/C++. The main purpose of the project is to create WPF GUI application to display data for [MRN Real-Time News](https://developers.thomsonreuters.com/sites/default/files/ThomsonReutersMRNElektronDataModelsv210_2.pdf) provided by RIC MRN_STORY. Anyway the core functionality of the application can be used to decode value of the field entry data inside XML element. Therefore it can use to open RSSL tracing log which contains data from other message model type such as Market Price, Market By Price and Market By Order. This utility should be able to help troubleshooting data issue or confirm the Market Price data or MRN Real-Time news data that API send and receive from Provider Server or TREP component.

## Prerequisites

Required software components:

* [.NET Framework ](https://www.microsoft.com/net/download/dotnet-framework/net461) - .NET Framework 4.6.1 or later version
* [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/)- We use Visual Studio 2017 to develop WPF GUI applicaiton.

Optional software components:

* [Visual Studio Code](https://code.visualstudio.com/) - IDE for edit source codes and open XML and JSON output from the application.


## Getting Started

The utility can be used on Windows OS only because it uses .NET Framework with WPF library which available for Windows development only. It require Visual Studio 2017 with .NET framework 4.6.1 to build the application. It requires some additional libraries for decoding XML data and parsing the JSON data. The application requires RDMFieldDictionary and enumtype.def to decode the raw data in Hex string format to the actual value. User can update dictionary inside folder Dict to the latest version. In case that the application unable to find field definition for some specific fid or custom fid and enum value, it will instead display original Hex string with the fid id instead of showing fid name. Note that you can download latest version of data dictionary from the [Software Download page](https://customers.thomsonreuters.com/a/support/technical/softwaredownload/default.aspx) and then search for product name "TREP Template service pack".

Anyway if you want the utility which can run on multiple OS such as mac os and linux, we have created console application which can decode and convert the data from RSSL tracing log to a new XML file. It share the core functionality with the GUI project. You can download it from [github](https://github.com/TR-API-Samples/Example.EMARFACPP.Tool.RSSLXMLTraceConverter).

# Overview

The utilities were designed for decoding data inside RSSL XML trace log which generated by RFA C++/.NET and EMA/ETA C/C++ and it can be used to display decoded data in WPF GUI. Basically, the RSSL XML trace file was provided for troubleshooting purpose only. There is some scenario that it required data from the tracing log to confirm data integrity the application received, therefore, there is the requirement to create a tool which can convert field entry value in Hex string format to actual value so that the user can compare the value with data the application received.

Normally when the application requesting data for Market Price and Level 2 Market By Price or Market by Order, the response message usually contains a field entry with field value in Hex string format. The utility can be used to read the XML Fragment and decode the Hex string in the field entry to actual data according the data type from data dictionary. Moreover it can be used to decode the [MRN Real-Time News](https://developers.thomsonreuters.com/article/introduction-machine-readable-news-mrn-elektron-message-api-ema) which provide by using MRN_STORY Ric. The tools have application's logic to scan the XML Fragment to find a series of compressed MRN fragment data inside the tracing log and then unpack the data and shows the MRN JSON data in the GUI.

## Utility download

The solution project is available for from [Github](https://developers.thomsonreuters.com/system/files/xxx.zip).

## How to collect RSSL Tracing log

The RSSL tracing log was provided for troubleshooting purpose and it's not turn on by default. User may use the following instruction to turn on the log in RFA C++/.NET and EMA C++ application. Please note that currently the utility does not support the trace from RFA and EMA java as it can't provide a valid XML trace format. There are some garbage or unexpected text inside the XML fragment and there are mixing between simple log and XML data inside the trace so that it cause the XML parser error. If you want to use the trace log from EMA java with the application, the workaround is to manually remove invalid text or string from XML fragment and save it to a valid xml file.

### RFA C++ and .NET application
User has to add the following configuration to turn on RSSL tracing log. 

```
\Connections\<Connection_RSSL>\connectionType    = "RSSL"
\Connections\<Connection_RSSL>\rsslPort     = "<RSSL Port>"
\Connections\<Connection_RSSL>\hostName        = "<ADS/Provider Hostname>"
\Connections\<Connection_RSSL>\traceMsg = false
\Connections\<Connection_RSSL>\traceMsgToFile = true
\Connections\<Connection_RSSL>\tracePing = true
\Connections\<Connection_RSSL>\traceMsgFileName   = "RSSLConsumerTrace"
\Connections\<Connection_RSSL>\traceMsgDomains = "all"
\Connections\<Connection_RSSL>\traceRespMsg = true
\Connections\<Connection_RSSL>\traceReqMsg = true
\Connections\<Connection_RSSL>\traceMsgHex = false 
\Connections\<Connection_RSSL>\traceMsgMaxMsgSize = 200000000
\Connections\<Connection_RSSL>\traceMsgMultipleFiles = true

```
Note that traceMsgFileName is the output xml file which RFA will generate under running directory. From above example, the output will be RSSLConsumerTrace_<pid>.xml where <pid> is the process id of the application.

### EMA C++ application

For EMA C++ application, user has to copy EmaConfig.xml which provided in EMA Examples folder to project directory or running directory and then add below XML to EMA configuration file under section Consumer to turn on the tracing log. Note that you have to set XmlTraceToFile to 1 to turn on the log and set it to 0 to turn off the log.

```
<DefaultConsumer value="Consumer_1"/>
<Consumer>
    <Name value="Consumer_1"/>
    ...
    <XmlTraceToFile value="1"/>
    <XmlTraceToStdout value="0"/>
</Consumer>
		
```
Though you are setting server name/ip and RSSL port in application codes and not using Channel config from the configuration file, you can also copy the configuration to the running directory and set the config under DefaultConsumer or DefaultProvider section. Above sample set DefaultConsumer to Consumer_1 then EMA internal will check the value inside the configuration file and verify option to turn on trace file from Consumer_1. And EMA will generate the RSSL Tracing log file name EmaTrace_<id>.xml under the running directory.

## Building and Running Utility

TO build the application you just clone the solution from github and then open solution file __RSSLTraceViewerGUI.sln__ with Visual Studio 2017. Then build the project with Debug or Release build.

![VisualStudio2017](/images/VS2017.PNG)

	
### Launching the application:

You can launch the application by click RSSLTraceViewerGUI.exe which locates under Release or Debug folder like the following sample path "<GitHubRepo>\Example.EMARFACPP.Tool.RSSLTraceViewer\RSSLTraceViewerGUI\bin\Release"

![LaunchingApplication](/images/launch.PNG)

It will shows blank Windows like the following screen shot.

![MainPage](/images/mainpagebullet.png)

There are 4 bullet from above images
1. Starter using the application user has to click __Load Trace file__ button to load XML file contains RSSL Trace log.
2. Bullet 2 is text box for display path to xml file after user click __Load Trace file__ button.
3. Bullet 3 is the area of DataGrid control using for display data like order of XML fragment from the file, time stamp, RDM Domain and Stream ID from the RSSL tracing log.
4. Bullet 4 is the area of Tree View which was designed to shows data for each XML fragment. 

### Usages

Client just click __Load Trace file__ button as described in previous section and the applicaiton will process the XML file and decoded the data in create internal data strcuture to bind the data to DataGrid.

![Load XML Trace file](/images/mainpage5.PNG)

The applicaiton will display XML fragments in DataGrid control like below sample. Please refer to information from previous section about the meaning of each bullet.

![MainPage](/images/mainpage_loaded.png)

There are additional information about the internal progress shows at the Windows capture and the following screenshot shows number of XML fragments inside the xml file.

![Additional Info](/images/AdditionalTab.png)

User can resize the windows and click at Grid Seperator at the position of Bullet 3 from the below screen shot. It allows user to freely move the Grid to left or right to review the data.

![GridSerator](/images/MovePane.png) 


#### Unpack MRN Data 

To unpack or display uncompressed MRN Real-Time news data, user has to double click each row inside the DataGrid area to display data at the right panel which view display data as TreeView. The applicaiton does not decoded data inside each XML fragment when it load the XML file. It will decode the data after user double DataGrid row, this can help speed up XML load times.

![ClickRow](/images/MRNLoaded2.png)

Above screen shot shows the data from RSSL tracing log which contains MRN Real-Times news data from MRN_STORY RIC. User just double click DataGrid row at the first step and then application will decode the data if it contains fieldEntry and construct a new TreeView control to display at position of Bullet 2 from the screenshot. Bullet 3 is __Unpack MRN Data__ used to unpack MRN data from selected XML fragment. Application has internal algorithm to find relavance XML fragmensn and uncompress the data and shows in a new windows like below screen shot. Note that the __Unpack MRN Data__ button will shows when you click at the row containing GUID only. If selected GUID contains invalid fragments list,the applicaiton will popup message box with details of the error. 
For example, 
Overall XML Fragments size less than or larger than total size specify in the first fragment of particular GUID.

![Display News](/images/DisplayMRNJson.png)

#### Display and Save MRN JSON data to file

Based on the DisplayMRNData screen shot from previous section there are four parts on the window.
1. Bullet 1 is text block for display uncompressed JSON data.
2. Bullet 2 area is a list of relavant XML fragments in a format of TreeView.
3. Bullet 3 is button for save the raw JSON data to file so that user can open the JSON file in other text editor to review data inside XML Fragments.
4. Bullet 4 is the area for display information about the GUID.

#### Display Level 1 and Level 2 Market Price data

User can just load the RSSL XML trace log contains Market Price data. The step to display data is the same as MRN but the data at the right hand side does not have button to Unapck MRN data.

![Display News](/images/MarektPriceBullet.png)

Applicaiton will decode fieldEntry and show Fid name and decoded value in the Treeview control. However, if the Fid id is custom fid and is not available in data dictionary, the application will display original Hex string instead.

#### Filtering data inside DataGrid 

There are an option for user to filter column such as Msg Type, Key(item name, user name in the message), Domain and Stream Id. It also provide interface to search MRN data by using GUID.

User can just click at the column header and applicaiton will filter all avaialbe data for each columns and popup combo box. User just tick check box inside combo box to filter the data for particular column. Below is sample screenshot when user click column header to filter data.

![DomainFiltering](/images/filterDomainBullet.png)

![MsgTypeFiltering](/images/filtermsgtye.png)

Below is output when select only refreshMsg

![MsgTypeFiltering](/images/msgtyperesult.PNG)

#### Searching GUID

If the data inside RSSL Tracing log contains MRN data with GUID list, the application will shows GUID search box above the DataGrid. User just input GUID in GUID search textbox and the click __Search__ button. The application will search GUID string based on the current data inside the DataGrid. Below screenshot is the sample output.

![MsgTypeFiltering](/images/GuidSearchBullet.png)

Bullet 1 is GUID string user want to search and Bullet 2 is the result. The functionality should be able to help user confirm if the data they receive contains the some specific GUID or not.

## Contributing

Please read [CONTRIBUTING.md](https://gist.github.com/PurpleBooth/b24679402957c63ec426) for details on our code of conduct, and the process for submitting pull requests to us.

## Authors

* **Moragodkrit Chumsri** - Release 1.0  *Initial work*


## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details
