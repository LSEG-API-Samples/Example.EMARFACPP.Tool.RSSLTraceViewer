# RSSL XML Trace Viewer Tools

The utility was designed for decoding and displaying the value from RSSL XML Tracing log generated by RFA C++/.NET and EMA/ETA C/C++. The main purpose of the project is to create WPF GUI application to display data for [MRN Real-Time News](https://developers.thomsonreuters.com/sites/default/files/ThomsonReutersMRNElektronDataModelsv210_2.pdf) provided by RIC MRN_STORY. Anyway the core functionality of the application can be used to decode value of the field entry data inside XML element. Therefore the application can be used to open RSSL tracing log which contains data from other message model type such as Market Price, Market By Price and Market By Order. This utility should be able to help troubleshooting data issue or confirm the Market Price data or MRN Real-Time news data that API send and receive from Provider Server or TREP component.

## Prerequisites

Required software components:

* [.NET Framework](https://www.microsoft.com/net/download/dotnet-framework/net461) - .NET Framework 4.6.1 or later version
* [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/)- We use Visual Studio 2017 with C# 7.0 to develop the applicaiton.

Optional software components:

* [Visual Studio Code](https://code.visualstudio.com/) - IDE for edit source codes and open XML and JSON output from the application.


## Getting Started

The utility can be used on Windows OS only because it uses .NET Framework with WPF library which available for Windows development only. It require Visual Studio 2017 with .NET framework 4.6.1 to build the application. It requires some additional libraries for decoding XML data and parsing the JSON data. The application requires RDMFieldDictionary and enumtype.def to decode the raw data in Hex string format to the actual value. User can update dictionary inside folder Dict to the latest version. In case that the application unable to find field definition for some specific fid or custom fid and enum value, it will instead display original Hex string with the fid id instead of showing fid name. Note that you can download latest version of data dictionary from the [Software Download page](https://customers.thomsonreuters.com/a/support/technical/softwaredownload/default.aspx) and then search for product name "TREP Template service pack".

Anyway if you want the utility which can run on multiple OS such as mac os and linux, we have created console application which can decode and convert the data from RSSL tracing log to a new XML file. It share the core functionality with the GUI project. You can download it from [github](https://github.com/TR-API-Samples/Example.EMARFACPP.Tool.RSSLXMLTraceConverter).

# Overview

The utilities were designed for decoding data inside RSSL XML trace log which generated by RFA C++/.NET and EMA/ETA C/C++ and it can be used to display decoded data in WPF GUI. Basically, the RSSL XML trace file was provided for troubleshooting purpose only. There is some scenario that it required data from the tracing log to confirm data integrity the application received, therefore, there is the requirement to create a tool which can convert field entry value in Hex string format to actual value so that the user can compare the value with data the application received.

Normally when the application requesting data for Market Price and Level 2 Market By Price or Market by Order, the response message usually contains a field entry with field value in Hex string format. The utility can be used to read the XML Fragment and decode the Hex string in the field entry to actual data according the data type from data dictionary. Moreover it can be used to decode the [MRN Real-Time News](https://developers.thomsonreuters.com/article/introduction-machine-readable-news-mrn-elektron-message-api-ema) which provide by using MRN_STORY Ric. The tools have application's logic to scan the XML Fragment to find a series of compressed MRN fragment data inside the tracing log and then unpack the data and shows the MRN JSON data in the GUI.

## Utility download

The solution project is available for from [Github](https://github.com/TR-API-Samples/Example.EMARFACPP.Tool.RSSLTraceViewer).

## How to collect RSSL Tracing log

The RSSL tracing log was provided for troubleshooting purpose and it's not turn on by default. User may use the following instruction to turn on the log in RFA C++/.NET and EMA C++ application. Please note that currently the utility does not support the trace from RFA and EMA java as it can't provide a valid XML trace format. There are some garbage or unexpected text inside the XML fragment and there are mixing between simple log and XML data inside the trace so that it cause the XML parser error. If you want to use the trace log from EMA java with the application, the workaround is to manually remove invalid text or string from XML fragment and save it to a valid xml file.

### RFA C++ and .NET application
User has to add the following configuration to turn on RSSL tracing log. 

```
\Connections\<Connection_RSSL>\connectionType    = "RSSL"
\Connections\<Connection_RSSL>\rsslPort     = "<RSSL Port>"
\Connections\<Connection_RSSL>\hostName        = "<ADS/Provider Hostname>"
\Connections\<Connection_RSSL>\traceMsg = false
\Connections\<Connection_RSSL>\traceMsgToFile = true
\Connections\<Connection_RSSL>\tracePing = true
\Connections\<Connection_RSSL>\traceMsgFileName   = "RSSLConsumerTrace"
\Connections\<Connection_RSSL>\traceMsgDomains = "all"
\Connections\<Connection_RSSL>\traceRespMsg = true
\Connections\<Connection_RSSL>\traceReqMsg = true
\Connections\<Connection_RSSL>\traceMsgHex = false 
\Connections\<Connection_RSSL>\traceMsgMaxMsgSize = 200000000
\Connections\<Connection_RSSL>\traceMsgMultipleFiles = true

```
Note that traceMsgFileName is the output xml file which RFA will generate under running directory. From above example, the output will be RSSLConsumerTrace_<pid>.xml where <pid> is the process id of the application.

### EMA C++ application

For EMA C++ application, user has to copy EmaConfig.xml which provided in EMA Examples folder to project directory or running directory and then add below XML to EMA configuration file under section Consumer to turn on the tracing log. Note that you have to set XmlTraceToFile to 1 to turn on the log and set it to 0 to turn off the log.

```
<DefaultConsumer value="Consumer_1"/>
<Consumer>
    <Name value="Consumer_1"/>
    ...
    <XmlTraceToFile value="1"/>
    <XmlTraceToStdout value="0"/>
</Consumer>
		
```
Though you are setting server name/ip and RSSL port in application codes and not using Channel config from the configuration file, you can also copy the configuration to the running directory and set the config under DefaultConsumer or DefaultProvider section. Above sample set DefaultConsumer to Consumer_1 then EMA internal will check the value inside the configuration file and verify option to turn on trace file from Consumer_1. And EMA will generate the RSSL Tracing log file name EmaTrace_<id>.xml under the running directory.

## Building and Running Utility

TO build the application you just clone the solution from github and then open solution file __RSSLTraceViewerGUI.sln__ with Visual Studio 2017. Then build the project with Debug or Release build.

![VisualStudio2017](/images/VS2017.PNG)

	
### Launching the application:

You can launch the application by click RSSLTraceViewerGUI.exe which locates under Release or Debug folder like the following sample path "<GitHubRepo>\Example.EMARFACPP.Tool.RSSLTraceViewer\RSSLTraceViewerGUI\bin\Release"

![LaunchingApplication](/images/launch.PNG)

It will shows blank Windows like the following screen shot.

![MainPage](/images/mainpagebullet.png)

There are 4 bullet from above images
1. Start using the application, user has to click __Load Trace file__ button to load XML file contains RSSL Trace log.
2. Bullet 2 is text box for display path to xml file after user click __Load Trace file__ button.
3. Bullet 3 is the area of DataGrid control for display XML fragment order by sequence of xml inside autual XML Tracing log. The DataGrid also display time stamp, RDM Domain, Stream ID including GUID of the MRN.
4. Bullet 4 is the area of Tree View for display decoded value inside the XML fragment.

### Usages

Client just click __Load Trace file__ button to load XML file as described in previous section and then the applicaiton will process the XML data and create internal data strcuture to keep XML Fragment list and then bind the data to DataGrid.

![Load XML Trace file](/images/mainpage5.PNG)

The applicaiton will display XML fragments in DataGrid control like below sample. Please refer to information from previous section about the meaning of each bullet.

![MainPage](/images/mainpage_loaded.png)

There are additional information from the internal processing log shows at the Windows caption. Following screenshot shows number of XML fragments inside the xml.

![Additional Info](/images/AdditionalTab.png)

User can resize the windows and click at Grid Seperator at the position of Bullet 3 from the below screen shot. It allows user to move the control to left or right.

![GridSerator](/images/MovePane.png) 

#### Unpack MRN Data 

To unpack or display uncompressed MRN Real-Time news data, user just double click DataGrid row to display data in TreeView at the right hand side. Actually the applicaiton does not decode XMLFragment data immediately after it load the XML file. Instead, it will decode the data after user double DataGrid row. This should help reduce XML file loading time at the first step.

![ClickRow](/images/MRNLoaded2.png)

Above screen shot shows the data from RSSL tracing log which contains MRN Real-Times news data from MRN_STORY RIC. User just double click DataGrid row then the application will check if the XML contents containing fieldEntry or not. It will create a new TreeView control to display XML data inside TreeView from bullet 2 in the sample screen shot. Bullet 3 is __Unpack MRN Data__ used to unpack MRN data from selected XML fragment. Basically the application has internal algorithm to find relavance XML Fragments and calll internal method to uncompress the data and shows in a new Window like below sample screen shot. Note that the __Unpack MRN Data__ button will shows when selected row containing GUID only. Moreover if selected GUID contains invalid fragments list,the applicaiton will popup message box with details of the error. For example, when overall XML Fragments size less than or larger than total size.

![Display News](/images/DisplayMRNJson.png)

#### Display and Save MRN JSON data to file

Based on the DisplayMRNData screen shot from previous section there are four parts on the window.

1. Bullet 1 is text block for display uncompressed JSON data.
2. Bullet 2 is a list of relavant XML fragments under TreeView structure.
3. Bullet 3 is button for saving the raw JSON data to file. User can open the JSON file in other text editor to review data inside XML Fragments.
4. Bullet 4 is the area for display information about the GUID.

#### Display Level 1 and Level 2 Market Price data

User can just load the RSSL XML trace log contains Market Price data. The step to display data is the same as MRN but the data at the right hand side does not have button to Unapck MRN data.

![Display News](/images/MarektPriceBullet.png)

Applicaiton will decode fieldEntry and show Fid name and decoded value in the Treeview control. However, if the Fid id is custom fid and is not available in data dictionary, the application will display original Hex string instead.

#### Filtering data inside DataGrid

There are an option for user to filter column such as Msg Type, Key(item name, user name in the message), Domain and Stream Id. It also provide interface to search MRN data by using GUID.

# RSSL XML Trace Viewer Tools

The utility was designed for decoding and displaying the value from RSSL XML Tracing log generated by RFA C++/.NET and EMA/ETA C/C++. The main purpose of the project is to create WPF GUI application to display data for [MRN Real-Time News](https://developers.thomsonreuters.com/sites/default/files/ThomsonReutersMRNElektronDataModelsv210_2.pdf) provided by RIC MRN_STORY. Anyway, the core functionality of the application can be used to decode value of the field entry data inside XML element. Therefore, the application can be used to open RSSL tracing log which contains data from other message model type such as Market Price, Market By Price and Market By Order. This utility should be able to help troubleshooting data issue or confirm the Market Price data or MRN Real-Time news data that API send and receive from Provider Server or TREP component.

## Prerequisites

Required software components:

* [.NET Framework](https://www.microsoft.com/net/download/dotnet-framework/net461) - .NET Framework 4.6.1 or later version
* [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/)- We use Visual Studio 2017 with C# 7.0 to develop the application.

Optional software components:

* [Visual Studio Code](https://code.visualstudio.com/) - IDE for edit source codes and open XML and JSON output from the application.

## Getting Started

The utility can be used on Windows OS only because it uses .NET Framework with WPF library which available for Windows development only. It requires Visual Studio 2017 with .NET framework 4.6.1 to build the application. It requires some additional libraries for decoding XML data and parsing the JSON data. The application requires RDMFieldDictionary and enumtype.def to decode the raw data in Hex string format to the actual value. User can update dictionary inside folder “Dict” to the latest version. In case that the application unable to find field definition for some specific fid or custom fid and enum value, it will instead display original Hex string with the fid id instead of showing fid name. Note that you can download latest version of data dictionary from the [Software Download page](https://customers.thomsonreuters.com/a/support/technical/softwaredownload/default.aspx) and then search for product name "TREP Template service pack".

Anyway, if you want the utility which can run on multiple OS such as mac OS and Linux, we have created the [RSSLTraceConverter]( https://github.com/TR-API-Samples/Example.EMARFACPP.Tool.RSSLXMLTraceConverter) which is console application which can decode and convert the data from RSSL tracing log to a new XML file. It shares the core functionality with this project. You can download it from [github](https://github.com/TR-API-Samples/Example.EMARFACPP.Tool.RSSLXMLTraceConverter).

# Overview

This utility was designed for decoding data inside RSSL XML trace log which generated by RFA C++/.NET and EMA/ETA C/C++ and it can be used to display decoded data in WPF GUI. Basically, the RSSL XML trace file was provided for troubleshooting purpose only. There is some scenario that it required data from the tracing log to confirm data integrity the application received, therefore, there is the requirement to create a tool which can convert field entry value in Hex string format to actual value so that the user can compare the value with data the application received.

Normally when the application requesting data for Market Price and Level 2 Market By Price or Market by Order, the response message usually contains a field entry with field value in Hex string format. The utility can be used to read the XML Fragment and decode the Hex string in the field entry to actual data according the data type from data dictionary. Moreover it can be used to decode the [MRN Real-Time News](https://developers.thomsonreuters.com/article/introduction-machine-readable-news-mrn-elektron-message-api-ema) which provide by using MRN_STORY Ric. The tools have application's logic to scan the XML Fragment to find a series of compressed MRN fragment data inside the tracing log and then unpack the data and shows the MRN JSON data in the GUI.

## Utility download

The solution project is available for from [Github](https://github.com/TR-API-Samples/Example.EMARFACPP.Tool.RSSLTraceViewer).

## How to collect RSSL Tracing log

The RSSL tracing log was provided for troubleshooting purpose and it's not turn on by default. User may use instruction from the next topics to turn on the log in RFA C++/.NET and EMA C++ application. Please note that currently the utility does not support Trace log file from RFA and EMA Java because it can't provide a valid XML format. There are some garbage or unexpected character and string inside the XML fragment and there are mixing between simple Logger message and the RSSL XML trace in the same Log file. As a result, it causes the XML parsing error. If you want to use the trace log from EMA java with the application, the workaround is to manually remove invalid character from XML fragment using other Text editor and save it to a new xml file.

### RFA C++ and .NET application
User has to add the following configuration to turn on RSSL tracing log. 

```
\Connections\<Connection_RSSL>\connectionType    = "RSSL"
\Connections\<Connection_RSSL>\rsslPort     = "<RSSL Port>"
\Connections\<Connection_RSSL>\hostName        = "<ADS/Provider Hostname>"
\Connections\<Connection_RSSL>\traceMsg = false
\Connections\<Connection_RSSL>\traceMsgToFile = true
\Connections\<Connection_RSSL>\tracePing = true
\Connections\<Connection_RSSL>\traceMsgFileName   = "RSSLConsumerTrace"
\Connections\<Connection_RSSL>\traceMsgDomains = "all"
\Connections\<Connection_RSSL>\traceRespMsg = true
\Connections\<Connection_RSSL>\traceReqMsg = true
\Connections\<Connection_RSSL>\traceMsgHex = false 
\Connections\<Connection_RSSL>\traceMsgMaxMsgSize = 200000000
\Connections\<Connection_RSSL>\traceMsgMultipleFiles = true

```
Note that __traceMsgFileName__ is the name of xml file which API will generate under running directory. Anyway, the format of the output will be RSSLConsumerTrace_<pid>.xml where <pid> is the process id of the application.

### EMA C++ application

For EMA C++ application, user has to copy EmaConfig.xml which provided in EMA Examples folder to project directory or running directory and then add below XML element to EMA configuration file under section __Consumer__ to turn on the tracing log. Note that you have to set XmlTraceToFile to 1 to turn on the log and set it to 0 to turn off the log.

```
<DefaultConsumer value="Consumer_1"/>
<Consumer>
    <Name value="Consumer_1"/>
    ...
    <XmlTraceToFile value="1"/>
    <XmlTraceToStdout value="0"/>
</Consumer>
        
```
Though you are setting server name/ip and RSSL port in application codes and not using Channel config from the configuration file, you can also copy the configuration to the running directory and set the config under DefaultConsumer or DefaultProvider section. From above sample, Consumer_1 is DefaultConsumer so that EMA internal will read the option to turn on/off RSSL tracing log from Consumer named __Consumer_1__. 

EMA will generate the RSSL Tracing log file named __EmaTrace_<id>.xml__ under the running directory.

## Building and Running Utility

TO build the application you just clone the solution from github and then open solution file __RSSLTraceViewerGUI.sln__ with Visual Studio 2017. Then build the project with Debug or Release build.

![VisualStudio2017](/images/VS2017.PNG)

    
### Launching the application:

If you build the utility using Visual Studio 2017, you can launch the application by click RSSLTraceViewerGUI.exe which locates under Release or Debug folder like the following sample path "<GitHubRepo>\Example.EMARFACPP.Tool.RSSLTraceViewer\RSSLTraceViewerGUI\bin\Release"

![LaunchingApplication](/images/launch.PNG)

It will show a new WPF Window like the following screenshot.

![MainPage](/images/mainpagebullet.png)

There are 4 bullets from above sample. Below is the meaning of each bullet.

1. Start using the application, user has to click __Load Trace file__ button to load XML file contains RSSL Trace log.
2. Bullet 2 is text box for display path to xml file after user click __Load Trace file__ button.
3. Bullet 3 is the area of DataGrid control for display XML fragment ordered by sequence of xml inside actual XML Tracing log. The DataGrid also display time stamp, RDM Domain, Stream ID including GUID of the MRN.
4. Bullet 4 is the area of Tree View component for display decoded XML.


### Usages

To start using the application, client just click __Load Trace file__ button to load XML file as described in previous section and then the application will process the XML data and create internal data structure to keep XML Fragment list and then bind the data to DataGrid.

![Load XML Trace file](/images/mainpage5.PNG)

Below sample is screenshot when the application display XML Fragment in Data Grid.

![MainPage](/images/mainpage_loaded.png)

There is an additional information from the internal application’s log shows at the Windows caption. Following sample is details about number of XML fragments the application read from the xml.

![Additional Info](/images/AdditionalTab.png)

User can resize the windows and click at the Grid Separator at the position of Bullet 3 from the below screen shot. It allows user to drag the Separator to left or right direction.

![GridSerator](/images/MovePane.png) 

#### Unpack MRN Data 

To unpack or display uncompressed MRN Real-Time news data, the first step, user has to double click DataGrid row which contains GUID they interest in order to display data in TreeView at the right-hand side. 

Actually, the application does not decode XMLFragment data immediately after it load the XML file. Instead, it will decode the data when user double clicks one of DataGrid row. This should help reduce XML loading time at the first step.

![ClickRow](/images/MRNLoaded2.png)

Above screen shot shows the data from RSSL tracing log which contains MRN Real-Times news data from MRN_STORY RIC. After user double click DataGrid row, it will create a new TreeView control to display XML data inside TreeView from bullet 2 in the sample screen shot. Bullet 3 is button __Unpack MRN Data__ used to unpack MRN data from selected DataGrid row. Basically, the application has an internal algorithm to find relevance XML Fragments and calls the internal function to uncompressing the data and shows in a new Window like the next sample screenshot.
![Display News](/images/DisplayMRNJson.png)

Note that the __Unpack MRN Data__ button will appear when selected row containing GUID only. Moreover, if selected GUID contains invalid fragments list, the application will popup message box with details of the error. For example, when overall XML Fragments size less than or larger than total size.

#### Display and Save MRN JSON data to file

Based on the DisplayMRNData screen shot from previous section there are four bullets on the window.

1. Bullet 1 is text block for display uncompressed JSON data.
2. Bullet 2 is a list of relevant XML fragments displaying using TreeView component.
3. Bullet 3 is button for saving the raw JSON data to file. User can open the JSON file in other text editor to review data inside XML Fragments.
4. Bullet 4 is the area for display information about the GUID.

#### Display Level 1 and Level 2 Market Price data

User can just load the RSSL XML trace log which contains Market Price or Level 2 Market data. The step to display data is the same as MRN but the difference is that it does not have button __Unpack MRN data__ at the right-hand side.

![Display News](/images/MarektPriceBullet.png)

Normally, application will check whether or not the XML element contains fieldEntry element. Next step it will use internal library to get Fid name and decoding field value and then add the value to Treeview element. However, if the Fid id is custom fid and it is not available in data dictionary, the application will display value as original Hex string instead.

#### Filtering data inside DataGrid

There is an option for user to filter data by clicking the small button at the DataGrid column. There are some columns which allow using use the filter that are Msg Type, Key (item name, user name in the message), Domain and Stream Id. The application also provides interface to search MRN data by using GUID.

To use the filter, user can just click at the small button on the column header, then it will pop up a Combo box containing a list of available filter values for each column. The user can just tick or untick a Checkbox inside the Combo box to select the value they interest. The application will apply the values with internal XML Fragments data and display data inside DataGrid based on the criteria. Below are sample screenshots when user click the button on the column header.

![DomainFiltering](/images/filterDomainBullet.png)

![MsgTypeFiltering](/images/filtermsgtye.png)

The following screenshot is sample output when user filter only refreshMsg.

![MsgTypeFiltering](/images/msgtyperesult.PNG)

#### Searching GUID

If the data inside RSSL Tracing log contains MRN data with GUID list, the application will show GUID search box above the DataGrid aread. User just input GUID text in GUID search box and the click __Search__ button. The application will perform searching the GUID with data insdie the DataGrid. Below screenshot is the sample output.

![MsgTypeFiltering](/images/GuidSearchBullet.png)

Bullet 1 is GUID string user want to search and Bullet 2 is the result. The functionality should be able to help user confirm if the data they receive contains the some specific GUID or not.

## Contributing

Please read [CONTRIBUTING.md](https://gist.github.com/PurpleBooth/b24679402957c63ec426) for details on our code of conduct, and the process for submitting pull requests to us.

## Authors

* **Moragodkrit Chumsri** - Release 1.0 *Initial work*

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details


